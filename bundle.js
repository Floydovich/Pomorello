!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.r(t);var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,a;return t=e,a=[{key:"info",value:function(t){e.level>=1&&e.log(t)}},{key:"debug",value:function(t){e.level>=2&&e.log(t)}},{key:"trace",value:function(t){e.level>=3&&e.log(t)}}],(r=null)&&n(t.prototype,r),a&&n(t,a),e}();function i(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function c(e){i(o,n,a,c,u,"next",e)}function u(e){i(o,n,a,c,u,"throw",e)}c(void 0)})}}function u(e,t,r){return s.apply(this,arguments)}function s(){return(s=c(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.trace("Starting new set"),e.abrupt("return",t.set("card","shared",{POMORELLO_ACTIVE:!0,POMORELLO_BREAK:!1,POMORELLO_START:Date.now(),POMORELLO_SET_LENGTH:r,POMORELLO_BREAK_LENGTH:n}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(e,t){return l.apply(this,arguments)}function l(){return(l=c(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.trace("Pomodoro for card ".concat(r.name," finished.")),t.alert({message:"Pomodoro for card ".concat(r.name," complete.\nTime to take a break!"),duration:10,display:"success"}),r.is_active=!1,r.is_break=!0,r.start=Date.now(),e.abrupt("return",r.sync(t));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p(e,t){return h.apply(this,arguments)}function h(){return(h=c(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.trace("Break for card ".concat(r.name," finished.")),t.alert({message:"Break for card ".concat(r.name," has ended!"),duration:10,display:"success"}),r.is_active=!1,r.is_break=!1,e.abrupt("return",r.sync(t));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){return e.refresh?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(r,!0).forEach(function(t){b(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({refresh:e.refresh},t):t}function g(e){o.debug("Displaying empty badge for card ".concat(e.name));return m(e,{text:"No Pomodoro Active",color:"yellow"})}function v(e){o.debug("Displaying status badge for card ".concat(e.name));var t={text:"Pomodoro Active: ".concat(e.timeStr()),color:"green"};return m(e,t)}function O(e){o.debug("Displaying break badge for card ".concat(e.name));var t={text:"Resting: ".concat(e.timeStr()),color:"blue"};return m(e,t)}function y(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function _(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){y(o,n,a,i,c,"next",e)}function c(e){y(o,n,a,i,c,"throw",e)}i(void 0)})}}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a(o,"level",2),a(o,"log",console.log);var P,k,R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o.trace("Constructing new card with refresh ".concat(t)),this.is_active=!1,this.is_break=!1,this.start_ms=0,this.set_length=15e5,this.break_length=3e5,this.name="?",this.refresh=t}var t,r,n,a,i;return t=e,(r=[{key:"fetch",value:(i=_(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.trace("Fetching data"),r=t.card("name"),e.next=4,t.getAll();case 4:return n=(n=e.sent).card.shared||{},o.trace("Got data"),this.is_active=n.POMORELLO_ACTIVE||this.is_active,this.is_break=n.POMORELLO_BREAK||this.is_break,this.start_ms=n.POMORELLO_START||this.start_ms,this.set_length=n.POMORELLO_SET_LENGTH||this.set_length,this.break_length=n.POMORELLO_BREAK_LENGTH||this.break_length,e.next=14,r;case 14:this.name=e.sent.name,o.info(JSON.stringify(this,null,2));case 16:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"sync",value:(a=_(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.trace("Syncing card ".concat(this.name)),e.abrupt("return",t.set("card","shared",{POMORELLO_ACTIVE:this.is_active,POMORELLO_BREAK:this.is_break,POMORELLO_START:this.start_ms,POMORELLO_SET_LENGTH:this.set_length,POMORELLO_BREAK_LENGTH:this.break_length}));case 2:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"age",value:function(){return o.trace("Computing age for card ".concat(this.name)),Date.now()-this.start_ms}},{key:"timeStr",value:function(){var e;o.trace("Formatting time for card ".concat(this.name)),this.is_active?e=this.set_length:this.is_break&&(e=this.break_length);var t=e-this.age(),r=Math.floor(t/1e3);this.refresh&&(r=this.refresh*Math.ceil(r/this.refresh)),o.trace("Formatting time for card ".concat(this.name,": ").concat(r," seconds"));var n=(Math.floor(r/60)%60).toFixed(0).padStart(2,"0"),a=(r%60).toFixed(0).padStart(2,"0");return"".concat(n,":").concat(a)}}])&&w(t.prototype,r),n&&w(t,n),e}();function x(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function E(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){x(o,n,a,i,c,"next",e)}function c(e){x(o,n,a,i,c,"throw",e)}i(void 0)})}}function L(e,t){o.trace("Showing dropdown powerup menu"),e.popup({title:"Start a Pomodoro",items:[{text:"Plain 25/5",callback:function(e,t){return u(e,15e5,3e5)}},{text:"Debug 1/0.5",callback:function(e,t){return u(e,6e4,3e4)}}]})}window.TrelloPowerUp.initialize({"card-buttons":(k=E(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{text:"Pomorello",callback:L}]);case 1:case"end":return e.stop()}},e)})),function(e,t){return k.apply(this,arguments)}),"card-badges":(P=E(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.trace("Loading card-badges"),e.abrupt("return",[{dynamic:function(){var e=E(regeneratorRuntime.mark(function e(){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new R,o.debug("State initialized"),e.next=4,r.fetch(t);case 4:if(o.info("State retrieved for card ".concat(r.name)),n=r.age(),!r.is_active){e.next=19;break}if(o.trace("Pomodoro active"),!(n>r.set_length)){e.next=15;break}return o.trace("Pomodoro expired"),e.next=12,f(t,r);case 12:return e.abrupt("return",O(r));case 15:return o.trace("Pomodoro in progress"),e.abrupt("return",v(r));case 17:e.next=34;break;case 19:if(!r.is_break){e.next=32;break}if(o.trace("Break active"),!(n>r.break_length)){e.next=28;break}return o.trace("Break expired"),e.next=25,p(t,r);case 25:return e.abrupt("return",g(r));case 28:return o.trace("Break in progress"),e.abrupt("return",O(r));case 30:e.next=34;break;case 32:return o.trace("No Pomodoro active"),e.abrupt("return",g(r));case 34:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]);case 2:case"end":return e.stop()}},e)})),function(e,t){return P.apply(this,arguments)})})}]);